{% extends 'base.html' %}

{% block main %}
<form id="reset-pswd-form"  class="mt-5 form w-50 border border-secondary rounded p-4 mx-auto">
  <h3 class="text-center">RESET PASSWORD</h3>
  <div class="form-group">
    <label for="pswd">Password</label>
    <input minlength="5" maxlength="20" type="password" id="pswd" name="pswd" class="form-control" aria-describedby="passwordHelpBlock" required />
    <small id="passwordHelpBlock" class="form-text text-muted">
      Must be at least 5 and max of 20 characters.
    </small>
  </div>
  <div class="form-group">
    <label for="pswd-cnfrm">Confirm Password</label>
    <input minlength="5" maxlength="20" type="password" id="pswd-cnfrm" name="pswd-cnfrm" class="form-control" aria-describedby="passwordHelpBlock" required />
  </div>
  <div class="text-center">
    <button type="submit" class="btn btn-primary">Submit</button>
  </div>
</form>

<div class="message"></div>
<a class="login-ref" href="/login" style="display: none;">Login</a>
<a class="forgot-pswd-ref" href="/forgotpassword" style="display: none;">Get a new Token</a>

<script>
  const resetPswdForm = document.getElementById('reset-pswd-form');
  const path = window.location.pathname;
  const msg = document.querySelector('.message');
  console.log(path);
  let response;
  resetPswdForm.addEventListener('submit', async(e) => {
    e.preventDefault();
    const data = {}
    data['pswd'] = document.querySelector("#pswd").value;
    data['pswd-cnfrm'] = document.querySelector("#pswd-cnfrm").value;
    response = await fetch(path, {
      method: 'POST',
      body: JSON.stringify(data),
      headers: {
      'Content-Type': 'application/json'
      },
    });
    const result = await response.json();
    console.log(response);
    console.log(result);
    msg.textContent = result;
    switch (response.status) {
      case 400:
        msg.style.color = 'red';
        break;
      case 403:
        msg.style.color = 'red';
        resetPswdForm.style.display = 'none';
        document.querySelector('.forgot-pswd-ref').style.display = 'block';
        break;
      case 200:
        msg.style.color = 'darkgreen';
        resetPswdForm.style.display = 'none';
        document.querySelector('.login-ref').style.display = 'block';
        break
      default:
        throw new Exception('Unexpected error');
    }
  })
</script>
{% endblock %}
